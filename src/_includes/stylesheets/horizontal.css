/* Keep contrasting with vertical.css */

html {
  writing-mode: horizontal-tb;

  font-size: clamp(
    13px,
    100vw / (2 * 4.236068 + 39),
    100vmin / (2 * 2.618034 + 29)
  );

  font-size: clamp(
    13px,
    100vi / (2 * 4.236068 + 39), /* φ³ */
    100vmin / (2 * 2.618034 + 29) /* φ² */
  );

  font-kerning: normal;
  font-feature-settings: "hkna";
}

body {
  min-block-size: 100vh;
  min-block-size: 100vb;
  max-inline-size: calc(39 / 29 * 100vh);
  max-inline-size: calc(39 / 29 * 100vb);
}

.title-page {
  min-block-size: 38.196601vw;
  min-block-size: 38.196601vi; /* φ⁻²; width/height = φ² */
}

.colophon {
  width: revert;
  max-width: revert;
}

.footnote-ref,
.footnote-backref {
  @extend .upright;
}

.footnote-ref {
  font-feature-settings: revert;
}

ol {
  list-style-type: revert;
}

ol:has(li:nth-of-type(11)),
ol:has(li:nth-of-type(21)) {
  padding-inline-start: 2em; /* Same as ol in layout.css */
}

/* 100-9999 */
ol:has(li:nth-of-type(100)) {
  padding-inline-start: 3em;
}

.table-wrapper {
  overflow-x: auto;
  overflow-inline: auto;

  @media (max-width: 427.25px) {
    word-break: keep-all;
  }

  @media (width < 428px) { /* Same as in page.njk */
    word-break: keep-all;
  }
}

:not(pre) > code {
  @media (max-width: 427.25px) {
    word-break: break-all;
  }

  @media (width < 428px) { /* Same as in page.njk */
    word-break: break-all;
  }
}

/* TODO: 主要ブラウザーと css-has-pseudo が :lang(ja, zh) をサポートしたら、この行を削除する。 */
/* ruby:not(lang(ja)):not(lang(jpn-archaic)):not(lang(zh)):has(rt:not(lang(ja)):not(lang(jpn-archaic)):not(lang(zh))), */
ruby:lang(ja):has(rt:lang(ja)),
ruby:lang(ja):has(rt:lang(jpn-archaic)),
ruby:lang(ja):has(rt:lang(zh)),
ruby:lang(jpn-archaic):has(rt:lang(ja)),
ruby:lang(jpn-archaic):has(rt:lang(jpn-archaic)),
ruby:lang(jpn-archaic):has(rt:lang(zh)),
ruby:lang(zh):has(rt:lang(ja)),
ruby:lang(zh):has(rt:lang(jpn-archaic)),
ruby:lang(zh):has(rt:lang(zh)) {
  text-transform: revert;
  ruby-align: revert;
  ruby-overhang: revert;
}

/* ruby:not(:lang(ja, jpn-archaic, zh)):has(rt:not(:lang(ja, jpn-archaic, zh))), */
ruby:lang(ja, jpn-archaic, zh):has(rt:lang(ja, jpn-archaic, zh)) {
  text-transform: revert;
  /* TODO: 熟字訓のグループルビは中央寄せする。 */
  /* TODO: 4文字以上のルビは下から順に上下に1文字づつ追い出す? */
  /* TODO: 行頭、行末ではルビを版面の外に出さない。 */
  ruby-align: revert;
  ruby-overhang: revert;
}

em,
em :where(:not(:lang(ja)):not(:lang(jpn-archaic))) {
  font-style: italic;
  font-family: var(--font-text);
}

em,
em :where(:not(:lang(ja, jpn-archaic))) {
  font-style: italic;
  font-family: var(--font-text);
}

em:where(:lang(ja)),
em:where(:lang(jpn-archaic)),
em :where(:lang(ja)),
em :where(:lang(jpn-archaic)) {
  font-style: normal;
  font-family: var(--font-text-emphasized);
}

em:where(:lang(ja, jpn-archaic)),
em :where(:lang(ja, jpn-archaic)) {
  font-style: normal;
  font-family: var(--font-text-emphasized);
}

b {
  font-weight: unset;
  text-emphasis-style: revert;
  text-decoration: underline;
}

/* mark { See text.css } */

/* i { See text.css } */

cite {
  font-style: revert; /* italic */
  font-family: var(--font-text);
}

/* cite, */
cite :where([lang]) {
  font-style: italic;
  font-family: var(--font-text);
}

.sideways {
  font-feature-settings: revert;
  text-orientation: revert;
}

:is(span, i):lang(iu) {
  @extend .sideways;
}

.upright {
  font-feature-settings: revert;
  text-orientation: revert;
}

.tate-chu-yoko {
  -webkit-text-combine: revert;
  text-combine-upright: revert;
}

.header-anchor {
  @extend .upright;
}

/* Keep contrasting with h# block-axis layout defined in layout.css */
:is(h1, h2, h3, h4, h5, h6):is([id]) /*- :has(.header-anchor) */ {
  scroll-margin-right: 0;
  scroll-margin-left: 0;
  scroll-margin-top: 1.618034em; /* φ */
  scroll-margin-bottom: 1em;
  scroll-margin-block-start: 1.618034em; /* φ */
  scroll-margin-block-end: 1em;
}

.footnote-ref a[id] {
  scroll-margin: 1em 0;
  scroll-margin-block: 1em;
  scroll-margin-inline: 0;
}

.footnotes-list {
  & li:is([id]) {
    scroll-margin: 0.5em 0;
    scroll-margin-block: 0.5em; /* half of (line-height - 1em) */
    scroll-margin-inline: 0;
  }
}

.kuntened {
  & rt:lang(ja), & rt:lang(jpn-archaic) {
    font-feature-settings: revert;
  }
  & rt:lang(ja, jpn-archaic) {
    font-feature-settings: revert;
  }
}

.katex-display {
  overflow-x: auto;
  overflow-y: clip;
}
