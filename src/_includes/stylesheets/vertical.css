/* Keep contrasting with horizontal.css */

html {
  writing-mode: vertical-rl;

  font-size: clamp(
    13px,
    min(100vh, 1.4 * 100vw) / (2 * 4.236068 + 39),
    100vw / (2 * 2.618034 + 29)
  );

  font-size: clamp(
    13px,
    min(100vi, 1.4 * 100vb) / (2 * 4.236068 + 39), /* φ³ */
    100vb / (2 * 2.618034 + 29) /* φ² */
  );

  font-kerning: revert;
  font-feature-settings: "vkrn", "vkna"; /* Don't set "vpal" */
}

body {
  min-block-size: 100vw;
  min-block-size: 100vb;
  max-inline-size: calc(1.4 * 100vw);
  max-inline-size: calc(1.4 * 100vb);
}

.title-page {
  min-block-size: 38.196601vh;
  min-block-size: 38.196601vi; /* φ⁻²; height/width = φ² */
}

.colophon {
  width: calc((100vh - 2 * 4.236068rem) / 1.4); /* φ³; 余白が最大のときに、余白を含めた縦横比が 1.4 になる比率 */
  max-width: calc(100vw - 2 * var(--colophon-margin-block)); /* 余白を含めた長さがビューポート幅と同じ */
}

/* .footnote-ref, */
.footnote-backref {
  @extend .upright;
}

/* .footnote-ref {
  font-feature-settings: "vkrn", "vkna", "fwid", "vpal"; /* .upright + "vpal"
} */

ol {
  list-style-type: cjk-ideographic;
  list-style-type: japanese-informal;
}

/* japanese-informal で最初に2文字になる数は「十一」 */
/* 11-20 */
ol:has(li:nth-of-type(11)) {
  padding-inline-start: 3em;
}

/* japanese-informal で最初に3文字になる数は「二十一」 */
/* 21-120 */
ol:has(li:nth-of-type(21)) {
  padding-inline-start: 4em;
}

ol:where(:not(:lang(ja)):not(:lang(jpn-archaic))) {
  list-style-type: revert;
}

ol:where(:not(:lang(ja, jpn-archaic))) {
  list-style-type: revert;
}

ol:where(:not(:lang(ja)):not(:lang(jpn-archaic))):has(li:nth-of-type(11)),
ol:where(:not(:lang(ja)):not(:lang(jpn-archaic))):has(li:nth-of-type(21)) {
  padding-inline-start: 2em; /* Same as ol in layout.css */
}

ol:where(:not(:lang(ja, jpn-archaic))):has(li:nth-of-type(11)),
ol:where(:not(:lang(ja, jpn-archaic))):has(li:nth-of-type(21)) {
  padding-inline-start: 2em; /* Same as ol in layout.css */
}

/* 100-9999 */
ol:where(:not(:lang(ja)):not(:lang(jpn-archaic))):has(li:nth-of-type(100)) {
  padding-inline-start: 3em;
}

/* 100-9999 */
ol:where(:not(:lang(ja, jpn-archaic))):has(li:nth-of-type(100)) {
  padding-inline-start: 3em;
}

:not(pre) > code {
  @media (max-height: 427.25px) {
    word-break: break-all;
  }

  @media (height < 428px) { /* Same as in page.njk */
    word-break: break-all;
  }
}

em {
  font-style: normal;
  font-family: var(--font-text-emphasized);

  & :where(*) {
    font-style: normal;
    font-family: var(--font-text-emphasized);
  }
}

b:where(:lang(ja)),
b:where(:lang(jpn-archaic)),
b :where(:lang(ja)),
b :where(:lang(jpn-archaic)) {
  font-weight: unset;
  text-emphasis-style: sesame;
  text-emphasis-position: over right;
  text-decoration: revert;
}

b:where(:lang(ja, jpn-archaic)),
b :where(:lang(ja, jpn-archaic)) {
  font-weight: unset;
  text-emphasis-style: sesame;
  text-emphasis-position: over right;
  text-decoration: revert;
}

/* mark { See text.css } */

/* i { See text.css } */

cite,
cite :where(:not(:lang(ja)):not(:lang(jpn-archaic))) {
  font-style: italic;
  font-family: var(--font-text);
}

cite,
cite :where(:not(:lang(ja, jpn-archaic))) {
  font-style: italic;
  font-family: var(--font-text);
}

cite:where(:lang(ja)),
cite:where(:lang(jpn-archaic)),
cite :where(:lang(ja)),
cite :where(:lang(jpn-archaic)) {
  font-style: normal;
  font-family: var(--font-text-emphasized);
}

cite:where(:lang(ja, jpn-archaic)),
cite :where(:lang(ja, jpn-archaic)) {
  font-style: normal;
  font-family: var(--font-text-emphasized);
}

/* NOTE: 和文中の欧文はデフォルトで text-orientation: sideways のやうに表示されるが、その場合、font-feature-settings は変更されない。 */
/* See also: JIS X 4051:2004 4.7 b */
.sideways {
  font-feature-settings: "hkna";
  &:where(:not(:lang(ja)):not(:lang(jpn-archaic))) {
    font-feature-settings: "palt", "hkna";
  }
  &:where(:not(:lang(ja, jpn-archaic))) {
    font-feature-settings: "palt", "hkna";
  }

  text-orientation: sideways;
}

/* See also: JIS X 4051:2004 4.7 b 備考 */
.upright {
  font-feature-settings: "vkrn", "vkna", "fwid";
  text-orientation: upright;
}

/* See also: JIS X 4051:2004 4.8 */
.tate-chu-yoko {
  -webkit-text-combine: horizontal; /* for Webkit */
  text-combine-upright: all;
}

.header-anchor {
  @extend .upright;
}

/* Keep contrasting with h# block-axis layout defined in layout.css */
:is(h1, h2, h3, h4, h5, h6):is([id]) /*- :has(.header-anchor) */ {
  scroll-margin-top: 0;
  scroll-margin-bottom: 0;
  scroll-margin-right: 1.618034em;
  scroll-margin-left: 1em;
  scroll-margin-block-start: 1.618034em; /* φ */
  scroll-margin-block-end: 1em; /* NOTE: Firefox (92.0) では水平方向に移動するページ内リンクはアンカーがスクリーンに収まるまでの最小距離を移動するので、アンカーがスクリーンの左側にある場合、この値が意味を持つことがある。 */
}

.footnote-ref a[id] {
  scroll-margin: 0 1em;
  scroll-margin-block: 1em;
  scroll-margin-inline: 0;
}

.footnotes-list {
  & li:is([id]) {
    scroll-margin: 0 0.5em;
    scroll-margin-block: 0.5em; /* half of (line-height - 1em) */
    scroll-margin-inline: 0;
  }
}

.kuntened {
  & rt:lang(ja), & rt:lang(jpn-archaic) {
    font-feature-settings: "vpal";
  }
  & rt:lang(ja, jpn-archaic) {
    font-feature-settings: "vpal";
  }
}
